(()=>{var e={};e.id=240,e.ids=[240],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9352:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>g,routeModule:()=>u,serverHooks:()=>p,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>c});var o={};s.r(o),s.d(o,{GET:()=>l});var r=s(6559),n=s(8088),a=s(7719),i=s(2190);async function l(){try{let e,t=process.env.QANYTHING_API_KEY;if(!t)return i.NextResponse.json({success:!1,error:"QAnything API Key not configured"},{status:500});try{let s=await fetch("https://openapi.youdao.com/q_anything/api/kb_list",{method:"GET",headers:{Authorization:t}});if(s.ok){let t=await s.json();console.log("Knowledge base list response:",t),0==t.errorCode&&t.result&&t.result.length>0&&(e=t.result[0].kbId,console.log("Using existing knowledge base:",e))}else{let e=await s.text();console.error("Failed to list knowledge bases:",s.status,e)}if(!e){console.log("Creating new knowledge base...");let s=await fetch("https://openapi.youdao.com/q_anything/api/create_kb",{method:"POST",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify({kbName:"Course Showcase 测试知识库"})});if(s.ok){let o=await s.json();if(console.log("Create knowledge base response:",o),0==o.errorCode){e=o.result.kbId,console.log("Created new knowledge base:",e);let s=new FormData;s.append("kbId",e),s.append("question","你好"),s.append("answer","你好！我是Course Showcase的AI助手，很高兴为您服务。");let r=await fetch("https://openapi.youdao.com/q_anything/api/upload_faq",{method:"POST",headers:{Authorization:t},body:s});if(r.ok){let e=await r.json();console.log("Added FAQ:",e.result?.faqId)}}else console.error("Failed to create knowledge base:",o)}else{let e=await s.text();console.error("Create knowledge base request failed:",s.status,e)}}}catch(e){console.error("Knowledge base setup error:",e)}let s={question:"你好",kbIds:e?[e]:[],prompt:"",history:[],model:"QAnything 4o mini",maxToken:200,hybridSearch:!1,networking:!0,sourceNeeded:!0};console.log("Testing QAnything API with data:",JSON.stringify(s,null,2)),console.log("Using API Key:",t.substring(0,10)+"...");let o=await fetch("https://openapi.youdao.com/q_anything/api/chat_stream",{method:"POST",headers:{Authorization:t,"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("QAnything API Response Status:",o.status),console.log("QAnything API Response Headers:",Object.fromEntries(o.headers.entries())),!o.ok){let e=await o.text();return console.error("QAnything API Error Response:",e),i.NextResponse.json({success:!1,error:`HTTP ${o.status}: ${o.statusText}`,details:e,requestData:s},{status:o.status})}let r=o.body?.getReader();if(!r)return i.NextResponse.json({success:!1,error:"无法读取响应流"},{status:500});let n=new TextDecoder,a=[],l=0;try{for(;l<3;){let{done:e,value:t}=await r.read();if(e)break;let s=n.decode(t,{stream:!0});a.push(s),l++}}finally{r.releaseLock()}return i.NextResponse.json({success:!0,message:"QAnything API connection successful",sampleChunks:a,requestData:s})}catch(e){return console.error("QAnything Test Error:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/qanything/test/route",pathname:"/api/qanything/test",filename:"route",bundlePath:"app/api/qanything/test/route"},resolvedPagePath:"C:\\Users\\24247\\Desktop\\新建文件夹\\新建文件夹\\src\\app\\api\\qanything\\test\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:d,workUnitAsyncStorage:c,serverHooks:p}=u;function g(){return(0,a.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:c})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[719,580],()=>s(9352));module.exports=o})();