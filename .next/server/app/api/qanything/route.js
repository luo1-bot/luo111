(()=>{var e={};e.id=5,e.ids=[5],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2343:(e,t,r)=>{"use strict";r.d(t,{AY:()=>u,Jt:()=>i,bE:()=>c});let s={timeout:3e4,retries:3};class n extends Error{constructor(e,t,r,s){super(t),this.code=e,this.status=r,this.details=s,this.name="ApiError"}}function a(e,t={}){let{timeout:r=s.timeout,...o}=t;return new Promise((t,s)=>{let a=new AbortController,i=setTimeout(()=>{a.abort(),s(new n("TIMEOUT",`请求超时 (${r}ms)`))},r);fetch(e,{...o,signal:a.signal}).then(t).catch(s).finally(()=>clearTimeout(i))})}async function o(e,t={}){let{retries:r=s.retries,baseURL:i="",headers:c={},...u}=t,d=i?`${i}${e}`:e,l={"Content-Type":"application/json",...c},p=Error("未知错误");for(let e=0;e<=r;e++)try{let e=await a(d,{...u,headers:l});if(!e.ok){let t=await e.text(),r=`HTTP ${e.status}: ${e.statusText}`;try{let e=JSON.parse(t);r=e.message||e.error||r}catch{t&&(r=t)}throw new n(`HTTP_${e.status}`,r,e.status)}let t=await e.json();return{success:!0,data:t}}catch(t){if(p=t,e===r)break;await new Promise(t=>setTimeout(t,1e3*(e+1)))}return p instanceof n?{success:!1,error:p.message}:{success:!1,error:p.message||"未知错误"}}function i(e,t){return o(e,{...t,method:"GET"})}function c(e,t,r){return o(e,{...r,method:"POST",body:t?JSON.stringify(t):void 0})}async function u(e,t={},r){let{headers:s={},...o}=t,i=await a(e,{...o,headers:{Accept:"text/event-stream","Cache-Control":"no-cache",...s}});if(!i.ok)throw new n(`HTTP_${i.status}`,`HTTP ${i.status}: ${i.statusText}`,i.status);let c=i.body?.getReader();if(!c)throw new n("STREAM_ERROR","无法读取响应流");let d=new TextDecoder;try{for(;;){let{done:e,value:t}=await c.read();if(e)break;let s=d.decode(t,{stream:!0});r(s)}}finally{c.releaseLock()}}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},6890:(e,t,r)=>{"use strict";r.d(t,{PV:()=>a,Sn:()=>s,bJ:()=>n,iu:()=>o});let s={WAKATIME:{BASE_URL:"https://api.wakatime.com/api/v1",ALL_TIME:"/users/current/all_time_since_today",STATS:"/users/current/stats",SUMMARIES:"/users/current/summaries",STATUS_BAR:"/users/current/status_bar/today"},QANYTHING:{BASE_URL:process.env.QANYTHING_API_BASE_URL||"https://openapi.youdao.com/q_anything/api",CHAT_STREAM:"/chat_stream",BOT_CHAT_STREAM:"/bot/chat_stream"}},n={"QAnything 4o mini":{name:"QAnything 4o mini",maxToken:{min:512,max:1024,default:512},description:"轻量级模型，响应速度快"},"QAnything 4o":{name:"QAnything 4o",maxToken:{min:1024,max:4096,default:1024},description:"标准模型，平衡性能与质量"},"deepseek-pro":{name:"deepseek-pro",maxToken:{min:1024,max:4096,default:1024},description:"专业模型，高质量回答"},"deepseek-lite":{name:"deepseek-lite",maxToken:{min:1024,max:4096,default:1024},description:"轻量级专业模型"},"deepseek-chat":{name:"deepseek-chat",maxToken:{min:1024,max:4096,default:1024},description:"对话优化模型"}},a={QANYTHING:{model:"QAnything 4o mini",maxToken:1024,hybridSearch:!1,networking:!1,sourceNeeded:!0,kbIds:[]},WAKATIME:{timeout:15,range:"Today"},UI:{toastDuration:5e3,animationDuration:300,debounceDelay:500}},o={HTML:{name:"HTML",color:"#E34F26",description:"HTML基础练习"},CSS:{name:"CSS",color:"#1572B6",description:"CSS样式练习"},JAVASCRIPT:{name:"JavaScript",color:"#F7DF1E",description:"JavaScript编程练习"},REACT:{name:"React",color:"#61DAFB",description:"React框架练习"},NEXTJS:{name:"Next.js",color:"#000000",description:"Next.js全栈练习"},PROJECT:{name:"综合项目",color:"#8B5CF6",description:"综合性项目练习"}}},7514:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>m,serverHooks:()=>T,workAsyncStorage:()=>A,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>h,POST:()=>p});var n=r(6559),a=r(8088),o=r(7719),i=r(2190),c=r(2343),u=r(6890);class d{constructor(){this.apiKey=process.env.QANYTHING_API_KEY||"",this.baseURL=u.Sn.QANYTHING.BASE_URL,this.apiKey||console.warn("QAnything API Key not found in environment variables")}getAuthHeaders(){if(!this.apiKey)throw Error("QAnything API Key is required");return{Authorization:this.apiKey}}async streamChat(e,t,r,s){try{let n={...u.PV.QANYTHING,...e};await (0,c.AY)(u.Sn.QANYTHING.CHAT_STREAM,{method:"POST",baseURL:this.baseURL,headers:this.getAuthHeaders(),body:JSON.stringify(n)},e=>{for(let r of e.split("\n"))if(r.startsWith("data: "))try{let e=JSON.parse(r.slice(6));0===e.errorCode&&e.result?.response?t(e.result.response):0!==e.errorCode&&s?.(e.msg||"QAnything API error")}catch{console.warn("Failed to parse SSE data:",r)}}),r?.()}catch(t){let e=t instanceof Error?t.message:"Unknown error";throw s?.(e),t}}async chat(e){try{let t={...u.PV.QANYTHING,...e},r=await (0,c.bE)("/chat",t,{baseURL:this.baseURL,headers:this.getAuthHeaders()});if(r.success&&r.data)if(0===r.data.errorCode)return{success:!0,data:r.data.result};else return{success:!1,error:r.data.msg||"QAnything API error"};return{success:!1,error:r.error||"Failed to get response from QAnything"}}catch(e){return{success:!1,error:`QAnything API Error: ${e instanceof Error?e.message:"Unknown error"}`}}}async checkConnection(){try{let e=await this.chat({question:"你好",kbIds:[],history:[],model:"QAnything 4o mini",maxToken:100});return{success:e.success,data:e.success,error:e.error}}catch(e){return{success:!1,data:!1,error:`Connection failed: ${e instanceof Error?e.message:"Unknown error"}`}}}getAvailableModels(){return Object.values(u.bJ)}validateRequest(e){return e.question&&0!==e.question.trim().length?e.question.length>200?{valid:!1,error:"问题长度不能超过200个字符"}:Array.isArray(e.kbIds)?Array.isArray(e.history)?e.history.length>2?{valid:!1,error:"历史记录最多支持2轮对话"}:e.prompt&&e.prompt.length>500?{valid:!1,error:"Prompt长度不能超过500个字符"}:{valid:!0}:{valid:!1,error:"历史记录必须是数组"}:{valid:!1,error:"知识库ID必须是数组"}:{valid:!1,error:"问题不能为空"}}}let l=new d;async function p(e){try{let t=await e.json(),r=l.validateRequest(t);if(!r.valid)return i.NextResponse.json({success:!1,error:r.error},{status:400});let s=await l.chat(t);if(s.success)return i.NextResponse.json(s);return i.NextResponse.json(s,{status:500})}catch(e){return console.error("QAnything API Error:",e),i.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function h(e){try{let{searchParams:t}=new URL(e.url);switch(t.get("action")||"models"){case"models":let r=l.getAvailableModels();return i.NextResponse.json({success:!0,data:r});case"check":let s=await l.checkConnection();return i.NextResponse.json(s);default:return i.NextResponse.json({success:!1,error:"Invalid action parameter"},{status:400})}}catch(e){return console.error("QAnything API Error:",e),i.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/qanything/route",pathname:"/api/qanything",filename:"route",bundlePath:"app/api/qanything/route"},resolvedPagePath:"C:\\Users\\24247\\Desktop\\新建文件夹\\新建文件夹\\src\\app\\api\\qanything\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:A,workUnitAsyncStorage:y,serverHooks:T}=m;function g(){return(0,o.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:y})}},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,580],()=>r(7514));module.exports=s})();